# DarkMatterDUNE

This repository contains analysis and utility scripts for constructing **directional angular distributions**
used in **Dark Matter** studies for the **DUNE experiment**.

The main purpose of this code is to generate **2D angular probability distributions** compatible with the
LArSoft **`SingleGen`** module, starting from detector-frame or sky-frame direction samples.

---

## Repository structure

```
DarkMatterDUNE/
├── gen_SingleGen_InputDist.py
├── gen_Detector_DensityAngDist.py
├── gen_map_HondaDensityAngDist.py
├── gen_map_AltAzDensityAngDist.py
├── README.md
├── .gitignore
```

---

## Physics context

The scripts in this repository are used to construct angular probability density functions (PDFs)
for particle directions at the DUNE Far Detector, including:
- Detector-frame direction sampling
- Line-of-sight (LOS) weighted angular distributions
- Conversion to the angular parameterization expected by **LArSoft SingleGen**

---

## Angular conventions (SingleGen)

The angular distributions follow the exact convention used internally by
`SingleGen_module.cc` in LArSoft.

Given angles `thetaXZ` and `thetaYZ`, the momentum direction is reconstructed as:

x = cos(thetaYZ) * sin(thetaXZ)  
y = sin(thetaYZ)  
z = cos(thetaYZ) * cos(thetaXZ)

with:
- `thetaXZ ∈ [-π, π]`  (azimuth in the XZ plane)
- `thetaYZ ∈ [-π/2, π/2]` (elevation from the XZ plane)

When building histograms from direction vectors `(x, y, z)`, the inverse relations are:

```python
thetaxz = atan2(x, z)
thetayz = asin(y)
```

These definitions are mandatory for consistency with SingleGen.

---

## Key script: `gen_SingleGen_InputDist.py`

This script:
1. Reads detector-frame direction samples `(X_drift, Y_zenith, Z_beam)`
2. Normalizes direction vectors
3. Computes `thetaXZ` and `thetaYZ` using SingleGen conventions
4. Builds a 2D angular histogram
5. Writes the histogram to a ROOT-compatible file for use in LArSoft

The resulting histogram can be referenced in FHiCL as:

```fhicl
AngleDist: "hist"
HistogramFile: "2dhist_los_density_sampled.root"
ThetaXzYzHist: ["angle_hist"]
```

---

## Dependencies

Required Python packages:
- `numpy`
- `uproot`

Optional (for plotting and diagnostics):
- `matplotlib`

Install with:
```bash
pip install numpy uproot matplotlib
```

---

## Data handling policy

- Large CSV files are **ignored**:

The product is generated by the scripts.

---

## Intended usage

This repository is intended for:
- Construction of angular PDFs for `SingleGen`
- Directional modeling in detector coordinates

It is **not** a full simulation framework, but a utility layer feeding into LArSoft workflows.

---

## Author

Leonardo Peres  
PhD student in Astroparticle Physics  
Federal University of Rio de Janeiro (UFRJ)  